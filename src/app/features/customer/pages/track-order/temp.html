<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Tracking Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Set a specific height for the map container */
        #map {
            height: 400px;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl p-6 bg-white rounded-2xl shadow-lg">
        <div class="mb-4 text-center">
            <h1 class="text-2xl font-bold text-gray-800">Your order is on the way!</h1>
            <p id="timer" class="text-lg text-green-600 font-semibold">
                Estimated arrival in: <span id="time-display">30:00</span>
            </p>
        </div>

        <!-- Google Map Container -->
        <div id="map" class="w-full rounded-xl overflow-hidden border-2 border-gray-300 bg-gray-200 flex items-center justify-center">
             <p class="text-gray-500">Loading map...</p>
        </div>
    </div>

    <script>
        let map;
        let deliveryAgentMarker;
        let animationInterval;
        const totalDuration = 30 * 60 * 1000; // 30 minutes in milliseconds

        // This function is called by the Google Maps script when it's loaded
        function initMap() {
            // Define start and end points for the delivery route in Chennai
            const startPoint = { lat: 13.0827, lng: 80.2707 }; // Example: Restaurant in Egmore
            const endPoint = { lat: 13.0075, lng: 80.2575 };   // Example: Home in Adyar

            // Initialize the map
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,
                center: startPoint,
                disableDefaultUI: true, // Hides default controls for a cleaner look
                styles: [ // Custom styles to declutter the map
                    { featureType: 'poi', stylers: [{ visibility: 'off' }] },
                    { featureType: 'transit', stylers: [{ visibility: 'off' }] }
                ]
            });

            const directionsService = new google.maps.DirectionsService();
            const directionsRenderer = new google.maps.DirectionsRenderer({
                suppressMarkers: true, // We will use our own custom markers
                polylineOptions: {
                    strokeColor: '#4A90E2',
                    strokeOpacity: 0.8,
                    strokeWeight: 6
                }
            });
            directionsRenderer.setMap(map);

            // Add a marker for the destination (home)
            new google.maps.Marker({
                position: endPoint,
                map: map,
                title: 'Your Location',
                icon: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#EA4335" width="40px" height="40px">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/>
                    </svg>
                `)
            });

            // SVG for the delivery agent's motorcycle icon
            const deliveryAgentIcon = {
                path: 'M22.5,14.5c0,0.8-0.7,1.5-1.5,1.5h-1v-2h1C21.8,14,22.5,14.2,22.5,14.5z M6.5,16c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S7.6,16,6.5,16z M17,11.5c-0.8,0-1.5,0.7-1.5,1.5v1h-1.4c-0.2-0.6-0.7-1.1-1.2-1.4L11,10.9V8c0-0.6-0.4-1-1-1S9,7.4,9,8v4.1l-2,1.1V10c0-1.1-0.9-2-2-2H2c-1.1,0-2,0.9-2,2s0.9,2,2,2h2.4l3.8,2.1c0.5,0.3,1,0.5,1.6,0.5h3.2v1h-1.5c-0.8,0-1.5,0.7-1.5,1.5S11.7,18,12.5,18H17c1.1,0,2-0.9,2-2v-3.5H17z M15.5,16c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S16.6,16,15.5,16z',
                fillColor: '#1A73E8',
                fillOpacity: 1,
                strokeWeight: 0,
                rotation: 0,
                scale: 1.3,
                anchor: new google.maps.Point(12, 12),
            };

            // Create the marker for the delivery agent
            deliveryAgentMarker = new google.maps.Marker({
                position: startPoint,
                map: map,
                icon: deliveryAgentIcon,
            });

            // Get the route and start the animation
            calculateAndDisplayRoute(directionsService, directionsRenderer, startPoint, endPoint);
        }
        
        // Calculates the route and initiates the marker animation
        function calculateAndDisplayRoute(service, renderer, start, end) {
            service.route({
                origin: start,
                destination: end,
                travelMode: google.maps.TravelMode.DRIVING
            }, (response, status) => {
                if (status === 'OK') {
                    renderer.setDirections(response);
                    const routePath = response.routes[0].overview_path;
                    animateDeliveryAgent(routePath);
                } else {
                    alert('Could not display directions due to: ' + status);
                }
            });
        }
        
        // Animates the delivery agent marker along the calculated path
        function animateDeliveryAgent(path) {
            const numSteps = path.length;
            if (numSteps === 0) return;
            
            let step = 0;
            const timePerStep = totalDuration / numSteps;

            animationInterval = setInterval(() => {
                step++;
                if (step >= numSteps) {
                    clearInterval(animationInterval);
                    return;
                }

                const newPosition = path[step];
                const oldPosition = path[step - 1];

                // Calculate the heading and rotate the icon to face the direction of travel
                const heading = google.maps.geometry.spherical.computeHeading(oldPosition, newPosition);
                const icon = deliveryAgentMarker.getIcon();
                icon.rotation = heading;
                deliveryAgentMarker.setIcon(icon);
                
                deliveryAgentMarker.setPosition(newPosition);
            }, timePerStep);
        }

        // Countdown timer logic
        document.addEventListener('DOMContentLoaded', () => {
            const timeDisplay = document.getElementById('time-display');
            let totalSeconds = 30 * 60;

            const timerInterval = setInterval(() => {
                totalSeconds--;
                if (totalSeconds < 0) totalSeconds = 0;

                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                
                timeDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                if (totalSeconds <= 0) {
                    clearInterval(timerInterval);
                    if (animationInterval) clearInterval(animationInterval); // Also stop map animation
                    const timerElement = document.getElementById('timer');
                    timerElement.textContent = "Your order has arrived!";
                    timerElement.classList.replace('text-green-600', 'text-blue-600');
                }
            }, 1000);
        });
    </script>
    <!-- 
      IMPORTANT: Replace "YOUR_GOOGLE_MAPS_API_KEY" with your actual Google Maps API key.
      The "geometry" library is included for calculating the icon's heading.
    -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap&libraries=geometry"></script>
</body>
</html>